{% extends "base.html" %}
{% block content %}


    <h3><p class="text-center">Автоматизированная система удаленного управления теплицей</p></h3>

    <div class="container" style="margin:15px auto">
      <div class="row">
        <div class="col-4">
          <div class="btn-group" role="group">
            <button id="btnGroupDrop1" type="button" class="btn btn-primary" class="btn btn-secondary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              Меню
            </button>
            <div class="dropdown-menu" aria-labelledby="btnGroupDrop1">
              <a class="dropdown-item" href="index">Главная</a>
              <a class="dropdown-item" href="table">Таблица значений</a>
              <a class="dropdown-item" href="about_us">О нас</a>
              <a class="dropdown-item" href="input">Введение значений</a>
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-4">

        </div>
      </div>
    </div>      
    <div class="container">
      <div class="row">
        <div class="col-4">
          <div class="btn-group" style="margin:5px auto" role="group">
            <button id="btnGroupDrop1" type="button" class="btn btn-secondary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              Датчики температуры/влажности
            </button>
            <div class="dropdown-menu" aria-labelledby="btnGroupDrop1">
              <a type="button" class="dropdown-item" onclick="graph_1()">Датчик № 1</a>
              <a class="dropdown-item" onclick="graph_2()">Датчик № 2</a>
              <a class="dropdown-item" onclick="graph_3()">Датчик № 3</a>
              <a class="dropdown-item" onclick="graph_4()">Датчик № 4</a>
            </div>
          </div>
          <div class="btn-group" style="margin:5px auto" role="group">
            <button id="btnGroupDrop1" type="button" class="btn btn-secondary dropdown-toggle"  data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              Датчики влажности почвы
            </button>
            <div class="dropdown-menu" aria-labelledby="btnGroupDrop1">
              <a class="dropdown-item" href="/index/humearth_1">Датчик № 1</a>
              <a class="dropdown-item" href="/index/humearth_2">Датчик № 2</a>
              <a class="dropdown-item" href="/index/humearth_3">Датчик № 3</a>
              <a class="dropdown-item" href="/index/humearth_4">Датчик № 4</a>
              <a class="dropdown-item" href="/index/humearth_5">Датчик № 5</a>
              <a class="dropdown-item" href="/index/humearth_6">Датчик № 6</a>
            </div>
          </div>
          <div class="dropdown">
            <button class="btn btn-secondary dropdown-toggle" style="margin:5px auto" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Открыть/Закрыть форточки теплицы 
            </button>
            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
              <a class="dropdown-item" href="#">Открыть</a>
              <a class="dropdown-item" href="#">Закрыть</a>
              <a class="dropdown-item" href="#">Текущий статус:</a>
              <a class="dropdown-item" href="#">Средняя температура:</a>
            </div>
          </div>
          <div class="dropdown">
            <button class="btn btn-secondary dropdown-toggle" style="margin:5px auto" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Открыть/Закрыть полив
            </button>
            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
              <a class="dropdown-item" href="#">Открыть</a>
              <a class="dropdown-item" href="#">Закрыть</a>
              <a class="dropdown-item" href="#">Текущий статус:</a>
              <a class="dropdown-item" href="#">Средняя влажность:</a>
            </div>
          </div>
          <div class="dropdown">
            <button class="btn btn-secondary dropdown-toggle" style="margin:5px auto" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Открыть/Закрыть увлажнение теплиц 
            </button>
            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
              <a class="dropdown-item" href="#">Открыть</a>
              <a class="dropdown-item" href="#">Закрыть</a>
              <a class="dropdown-item" href="#">Текущий статус:</a>
              <a class="dropdown-item" href="#">Средняя влажность почвы:</a>
            </div>
          </div>
        </div>
        <div class="col-8">       
          <canvas id="myChart" style="background-image: url(https://kartinkin.net/pics/uploads/posts/2022-08/1660407500_2-kartinkin-net-p-chisto-chernie-oboi-na-telefon-krasivo-2.jpg)"></canvas>
        </div> 
      </div>
    </div>

    <script>

      graph_1()
      
      test1 = []
      function graph(number){    
        let xhr = new XMLHttpRequest();
        xhr.open('GET', '/index/temp_hum?number='+number);
        xhr.send();
        var paramsString = document.location.href.split("/");
        console.log(paramsString[paramsString.length-1]);
        xhr.onload = function() {
          data = JSON.parse(xhr.response);
          test1.push(data)
          console.log(data)
          console.log(data["date"])
          console.log(data["temp"])
          console.log(data["hum"])
          var ctx = document.getElementById("myChart").getContext("2d");
          var myChart = new Chart(ctx, {
            type: "line",
              data: {
                labels: data["date"],
                datasets: [
                  {
                    label: "Температура, °C",
                    data: data["temp"],
                    backgroundColor: "rgba(153,205,1,0.6)",
                  },
                  {
                    label: "Влажность, %",
                    data: data["hum"],
                    backgroundColor: "rgba(155,153,10,0.6)",
                  },
                ],
              },
            });
          };
        }
      function graph_1(){
        graph(1);
        return false;
      }
      function graph_2(){
        graph(2);
        return false;
      }
      function graph_3(){
        graph(3);
        return false;
      }
      function graph_4(){
        graph(4);
        return false;
      }
        </script>
{% endblock %}